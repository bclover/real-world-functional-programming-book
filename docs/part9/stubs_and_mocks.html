
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Why We Use Stubs and Not Mocks Â· GitBook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="testing.html" />
    
    
    <link rel="prev" href="./" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="../part1/">
            
                <a href="../part1/">
            
                    
                    Part 1: Pure Functions
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1" data-path="../part1/input_output_side_effects.html">
            
                <a href="../part1/input_output_side_effects.html">
            
                    
                    Same Input, Same Output, No Side Effects
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2" data-path="../part1/var_and_let.html">
            
                <a href="../part1/var_and_let.html">
            
                    
                    The Case for var and let
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3" data-path="../part1/spot_the_impurities.html">
            
                <a href="../part1/spot_the_impurities.html">
            
                    
                    Spot The Impurities
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.4" data-path="../part1/error_quest.html">
            
                <a href="../part1/error_quest.html">
            
                    
                    Error Quest!
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.5" data-path="../part1/not_allowed.html">
            
                <a href="../part1/not_allowed.html">
            
                    
                    What's Not Allowed
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.6" data-path="../part1/practice_purity.html">
            
                <a href="../part1/practice_purity.html">
            
                    
                    Practice Purity with Predicates
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.7" data-path="../part1/practice_stubs.html">
            
                <a href="../part1/practice_stubs.html">
            
                    
                    Practice Purity with Test Stubs
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="../part2/">
            
                <a href="../part2/">
            
                    
                    Part 2: Getting and Setting Data
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" data-path="../part2/trouble_with_dots.html">
            
                <a href="../part2/trouble_with_dots.html">
            
                    
                    Trouble With Dots
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2" data-path="../part2/get.html">
            
                <a href="../part2/get.html">
            
                    
                    Get
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.3" data-path="../part2/set.html">
            
                <a href="../part2/set.html">
            
                    
                    Set
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.4" data-path="../part2/lenses.html">
            
                <a href="../part2/lenses.html">
            
                    
                    Lenses
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.5" data-path="../part2/practice_big_json.md">
            
                <span>
            
                    
                    Practice get with Big JSON
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.6" data-path="../part2/practice_big_json.md">
            
                <span>
            
                    
                    Practice get with SOAP
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="../part3/">
            
                <a href="../part3/">
            
                    
                    Part 3: List Comprehensions
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" data-path="../part3/map.html">
            
                <a href="../part3/map.html">
            
                    
                    map
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2" data-path="../part3/filter.html">
            
                <a href="../part3/filter.html">
            
                    
                    filter
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.3" data-path="../part3/reduce.html">
            
                <a href="../part3/reduce.html">
            
                    
                    reduce
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.4" data-path="../part3/every.html">
            
                <a href="../part3/every.html">
            
                    
                    every
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.5" data-path="../part3/some.html">
            
                <a href="../part3/some.html">
            
                    
                    some
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.6" data-path="../part3/zip.md">
            
                <span>
            
                    
                    zip
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.7" data-path="../part3/practice_every.md">
            
                <span>
            
                    
                    Practice every with Predicates
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.8" data-path="../part3/practice_map.md">
            
                <span>
            
                    
                    Practice map with JSON
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="../part4/">
            
                <a href="../part4/">
            
                    
                    Part 4: Curry and Partial Application
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1" data-path="../part4/curry.html">
            
                <a href="../part4/curry.html">
            
                    
                    All Functions Take 1 Argument
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2" data-path="../part4/parameter_order.html">
            
                <a href="../part4/parameter_order.html">
            
                    
                    Parameter Order
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.3" data-path="../part4/partial_application.html">
            
                <a href="../part4/partial_application.html">
            
                    
                    Partial Application
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.4" data-path="../part4/arity.html">
            
                <a href="../part4/arity.html">
            
                    
                    Arity
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.5" data-path="../part4/styles_of_curry.html">
            
                <a href="../part4/styles_of_curry.html">
            
                    
                    Styles Of Curry
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.6" data-path="../part4/lodash_fp.html">
            
                <a href="../part4/lodash_fp.html">
            
                    
                    Lodash FP
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.7" data-path="../part4/practice_curry_predicates.md">
            
                <span>
            
                    
                    Practice with Predicates
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.8" data-path="../part4/practice_">
            
                <span>
            
                    
                    Practice with Express
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6" data-path="../part5/">
            
                <a href="../part5/">
            
                    
                    Part 5: Composition
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.1" data-path="../part5/passing_functions_to_functions.html">
            
                <a href="../part5/passing_functions_to_functions.html">
            
                    
                    Passing Functions to Functions
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.2" data-path="../part5/composing_functions.html">
            
                <a href="../part5/composing_functions.html">
            
                    
                    Composing Functions
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.3" data-path="../part5/tacit_programming.html">
            
                <a href="../part5/tacit_programming.html">
            
                    
                    Tacit Programming
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.7" data-path="../part6/">
            
                <a href="../part6/">
            
                    
                    Part 6: Algebraic Data Types
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.7.1" data-path="../part6/maybe.html">
            
                <a href="../part6/maybe.html">
            
                    
                    Maybe
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.2" data-path="../part6/validation.html">
            
                <a href="../part6/validation.html">
            
                    
                    Validation
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.3" data-path="../part6/result.html">
            
                <a href="../part6/result.html">
            
                    
                    Result
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.4" data-path="../part6/union.html">
            
                <a href="../part6/union.html">
            
                    
                    Union
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.5" data-path="../part6/practice_maybe_config.md">
            
                <span>
            
                    
                    Practice Maybe with config
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.6" data-path="../part6/practice_validator_predicates.md">
            
                <span>
            
                    
                    Practice Validator with Predicates
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.7" data-path="../part6/practice_result_json.md">
            
                <span>
            
                    
                    Practice Result with JSON
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.8" data-path="../part6/practice_union_files.md">
            
                <span>
            
                    
                    Practice Union with reading files
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.8" data-path="../part7/">
            
                <a href="../part7/">
            
                    
                    Part 7: Total Functions
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9" data-path="../part8/">
            
                <a href="../part8/">
            
                    
                    Part 8: Debugging
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.9.1" data-path="../part8/logging_vs_purity.md">
            
                <span>
            
                    
                    Tap
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2" data-path="../part8/logging_purity.md">
            
                <span>
            
                    
                    Logging vs Purity
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.10" data-path="./">
            
                <a href="./">
            
                    
                    Part 9: Testing
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter active" data-level="1.10.1" data-path="stubs_and_mocks.html">
            
                <a href="stubs_and_mocks.html">
            
                    
                    Why We Use Stubs and Not Mocks
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.2" data-path="testing.html">
            
                <a href="testing.html">
            
                    
                    Testing
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.3" data-path="property_testing.md">
            
                <span>
            
                    
                    Predicate Property Testing
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.11" data-path="../part10/README.md">
            
                <span>
            
                    
                    Part 10: Working With Others
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.11.1" data-path="../part10/heed_the_warnings.md">
            
                <span>
            
                    
                    Heed the Warnings
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.2" data-path="../part10/imperatives.md">
            
                <span>
            
                    
                    Dealing with Imperatives
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.3" data-path="../part10/oop.md">
            
                <span>
            
                    
                    Dealing with OOP
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11.4" data-path="../part10/safe_advice.md">
            
                <span>
            
                    
                    Safe Advice
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.12" data-path="../conclusions/README.md">
            
                <span>
            
                    
                    Conclusions
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >Why We Use Stubs and Not Mocks</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="only-stubs-no-more-mocks-or-spies">Only Stubs, No More Mocks or Spies</h1>
<p>You don&apos;t need mocks in Functional Programming because mocks test side effects. If you&apos;re writing Functional code, it is made up of pure functions. Pure functions don&apos;t have side effects. So no need for mocks. If you&apos;re trying to isolate code, you may still need stubs.</p>
<h2 id="unit-test">Unit Test</h2>
<p>A unit test is supposed to be a unit. No one knows (but think they know) what a unit is in programming. For now, a unit is any Object you want to test: Object, class, function, module, whatever.</p>
<h2 id="object-under-test">Object Under Test</h2>
<p>An &quot;object under test&quot; is the thing you&apos;re testing. If you have an <code>it</code> in Jasmine/Mocha in JavaScript or Busted in Lua, or a <code>test_*</code> function Python&apos;s PyTest, whatever that test function is supposed to be testing, that&apos;s the &quot;object under test&quot;. Given how Mocks/Spies work, however, it may not be immediately obvious &quot;what is the actual object under test here?&quot;</p>
<h2 id="what-is-a-stub">What is a Stub?</h2>
<p>A stub is typically an <code>Object</code> or <code>Function</code> that always does the same thing, typically returning the value you need. If you want your unit tests to be deterministic, and thus dependable, you ensure they always do the same thing every time they run. Given our <code>loadWebsite</code> function:</p>
<pre><code class="lang-javascript"><span class="hljs-keyword">const</span> loadWebsite = request =&gt; url =&gt; ...
</code></pre>
<p>If we want to stub <code>request</code> to guarantee the test works whether the internet works or not with minimal side effects, you stub it:</p>
<pre><code class="lang-javascript"><span class="hljs-keyword">const</span> requestStub = {
    get: (url, callback) =&gt; callback(<span class="hljs-literal">undefined</span>, {}, <span class="hljs-string">&apos;hey&apos;</span>)
}
</code></pre>
<p>This stub is mostly a pure function, and we can use it to create a dependable unit test:</p>
<pre><code class="lang-javascript">it(<span class="hljs-string">&apos;loadWebsite should work&apos;</span>, ()=&gt; {
    <span class="hljs-keyword">return</span> loadWebsite(requestStub, <span class="hljs-string">&apos;some url&apos;</span>)
    .then(result =&gt; {
        expect(result).toBe(<span class="hljs-string">&apos;hey&apos;</span>)
    })
})
</code></pre>
<h2 id="what-is-a-mock">What is a Mock?</h2>
<p>Mocks are stubs that can track what happened to them during the test execution. You can then make assertions on what they remember. They are sometimes called spies because the Object will record what it sees &quot;covertly&quot;. Whether using Object Oriented Programming or Functional, the &quot;how things happen&quot; is intended to be hidden, so using an Object in this way is considered spying. In Dynamic languages, they&apos;ll sometimes re-use a real implementation, and overwrite functions, methods, or properties with temporary Objects unlike statically typed languages where it&apos;s wrapped through Composition. This may cause a <code>restore</code> step, where you turn the Object back to the way it was after the test/suite.</p>
<p>Let&apos;s cover post assertions, testing specifically for side effects, and pre-assertions.</p>
<h2 id="mocks-in-post-assertions">Mocks in Post Assertions</h2>
<p>Given our old school <code>for</code> loop:</p>
<pre><code class="lang-javascript"><span class="hljs-keyword">const</span> getParsedNames = (names, callback) =&gt; {
    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; names.length; i++) {
        <span class="hljs-keyword">const</span> parsedName = parseName(names[i])
        callback(parsedName, i)
    }
}
</code></pre>
<p>We can test what happened to the callback; did it get inside the function and get used like we think it should? To do that, we need a function that remembers what happened to itself.</p>
<pre><code class="lang-javascript"><span class="hljs-keyword">const</span> mockCallback = (...args) =&gt; {
    mockCallback.calls++
    mockCallback.calledWith.push(args)
}
mockCallback.calls = <span class="hljs-number">0</span>
mockCallback.calledWith = []
</code></pre>
<p>Not when we test it, we can make some assertions on it in the test:</p>
<pre><code class="lang-javascript">it(<span class="hljs-string">&apos;getParsedNames should be called with correct parsed names 3 times for 3 item array&apos;</span>, ()=&gt; {
    <span class="hljs-keyword">const</span> names = [<span class="hljs-string">&apos;jesse warden&apos;</span>, <span class="hljs-string">&apos;brandy fortune&apos;</span>, <span class="hljs-string">&apos;albus dumbledog&apos;</span>]
    getParsedNames(names, mockCallback)
    expect(mockCallback.calls).toBe(<span class="hljs-number">3</span>)
    expect(mockCallback.calledWith[<span class="hljs-number">1</span>][<span class="hljs-number">0</span>]).toBe(<span class="hljs-string">&apos;Fortune, Brandy&apos;</span>)
})
</code></pre>
<h3 id="call-something-here-read-about-it-over-there">Call Something Here, Read About It Over There</h3>
<p>Pure function rules are same input, same output, and no side effects. Class methods typically are not pure functions because although they sometimes may have inputs, many don&apos;t have return values, and almost always are setting data internally on a mutable <code>this</code> or <code>self</code> property that is the place where all the data internally for the class is stored. While you can write pure functions in a class, and even make them public, if you&apos;re using a class, you&apos;re going to follow the Object Oriented Programming rule of encapsulation. That is hiding data internally, and exposing access to it from a public API.</p>
<p>In a sense, one could argue that a class can be a pure function because it can follow the spirit of the pure function rules:</p>
<pre><code class="lang-javascript"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Adder</span> </span>{
    add(a, b) =&gt; {
        <span class="hljs-keyword">this</span>._result = a + b
    }
    get result() {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.result
    }
}

<span class="hljs-keyword">const</span> a = <span class="hljs-keyword">new</span> Adder()
a.add(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>)
<span class="hljs-built_in">console</span>.log(<span class="hljs-string">&quot;result:&quot;</span>, a.result)
</code></pre>
<p>However, as soon as you test it, you know you&apos;re testing side effects because there:</p>
<ul>
<li>is no return value</li>
<li>the value changes on the object after you set a method</li>
</ul>
<pre><code class="lang-javascript">it(<span class="hljs-string">&quot;Adder&apos;s add, when called will add 2 numbers&quot;</span>, () =&gt; {
    <span class="hljs-keyword">const</span> instance = <span class="hljs-keyword">new</span> Adder()
    expect(instance.result).toBe(<span class="hljs-literal">undefined</span>)
    <span class="hljs-keyword">const</span> result = instance.add(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>)
    expect(instance.result).toBe(<span class="hljs-number">3</span>)
    expect(result).toBe(<span class="hljs-literal">undefined</span>)
})
</code></pre>
<p>Let&apos;s read those expectations in order:</p>
<ol>
<li>Make sure the Object&apos;s result property is <code>undefined</code></li>
<li>Make sure the method has a side effect on the Object.</li>
<li>Make sure the method didn&apos;t return a result.</li>
</ol>
<p>Let&apos;s re-write that as a pure function with test:</p>
<pre><code class="lang-javascript"><span class="hljs-keyword">const</span> add = (a, b) =&gt; a + b

it(<span class="hljs-string">&apos;add will add 2 numbers&apos;</span>, () =&gt; {
    <span class="hljs-keyword">const</span> result = add(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>)
    expect(result).toBe(<span class="hljs-number">3</span>)
})
</code></pre>
<p>Has a return value, no need to check before and after for side effects.</p>
<h3 id="pre-programmed-assertions">Pre-programmed Assertions</h3>
<p>Traditionally, mocks are known for pre-programmed assertions. You use them in this way to ensure things are being used as expected... if not, fail the test. Instead of testing how something was used, like a spy, you make your assertions before you even call your object under test. Let&apos;s OOP-i-fy our names parser using <a href="https://www.typescriptlang.org/docs/handbook/classes.html" target="_blank">TypeScript</a> so we can enforce public/private properties and methods:</p>
<pre><code class="lang-javascript"><span class="hljs-keyword">import</span> { startCase } <span class="hljs-keyword">from</span> <span class="hljs-string">&apos;lodash&apos;</span>

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">NamesParser</span> </span>{

    private names: <span class="hljs-built_in">Array</span>&lt;<span class="hljs-built_in">String</span>&gt;

    private _parsedNames: <span class="hljs-built_in">Array</span>&lt;<span class="hljs-built_in">String</span>&gt;

    public get parsedNames(): <span class="hljs-built_in">Array</span>&lt;<span class="hljs-built_in">String</span>&gt; {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>._parsedNames
    }

    <span class="hljs-keyword">constructor</span>(names: Array&lt;String&gt;) {
        <span class="hljs-keyword">this</span>.names = names
        <span class="hljs-keyword">this</span>._parsedNames = []
    }

    private parseName(name) : <span class="hljs-built_in">String</span> {
        <span class="hljs-keyword">return</span> name.split(<span class="hljs-string">&apos; &apos;</span>).reverse().map(startCase).join(<span class="hljs-string">&apos;, &apos;</span>)
    }

    public parseNames() {
        <span class="hljs-keyword">this</span>._parsedNames = []
        <span class="hljs-keyword">for</span>(<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-keyword">this</span>.names.length; i++) {
            <span class="hljs-keyword">this</span>._parsedNames[i] = <span class="hljs-keyword">this</span>.parseName(<span class="hljs-keyword">this</span>.names[i])
        }
    }
}
</code></pre>
<p>For the unit test, we know it should return a good value, so let&apos;s build that assertion into the mock.</p>
<p>The one will one will pass because <code>parseName</code> is only being called once for the 1 item in the Array:</p>
<pre><code class="lang-javascript">it(<span class="hljs-string">&apos;NamesParser should call parseName one time for 1 value&apos;</span>, () =&gt; {
    <span class="hljs-keyword">const</span> parser = <span class="hljs-keyword">new</span> NamesParser([<span class="hljs-string">&apos;jesse warden&apos;</span>])
    <span class="hljs-keyword">const</span> mock = sinon.mock(parser)
    mock.expects(<span class="hljs-string">&quot;parseName&quot;</span>).once().throws()
    parser.parseNames()
    mock.verify()
})
</code></pre>
<p>This one fails because we gave it 2 items, but keep the expectation that will will call <code>parseName</code> 1 time:</p>
<pre><code class="lang-javascript">it(<span class="hljs-string">&apos;NamesParser should call parseName one time for 1 value&apos;</span>, () =&gt; {
    <span class="hljs-keyword">const</span> parser = <span class="hljs-keyword">new</span> NamesParser([<span class="hljs-string">&apos;jesse warden&apos;</span>, <span class="hljs-string">&apos;brandy fortune&apos;</span>])
    <span class="hljs-keyword">const</span> mock = sinon.mock(parser)
    mock.expects(<span class="hljs-string">&quot;parseName&quot;</span>).once().throws()
    parser.parseNames()
    mock.verify()
})
</code></pre>
<p>Again, test one thing here, but look for the results over there. With Mocks via pre-programmed assertions, you&apos;ve doing 4 nasty things:</p>
<ol>
<li>mutating the object under test</li>
<li>testing specifically for side effects</li>
<li>intentionally throwing an <code>Error</code></li>
<li>re-mutate the object after the test</li>
</ol>
<p>While 1 and 4 do not follow pure function rules, you get a pass since you&apos;re in a dynamic language, and that&apos;s one of the reasons we like dynamic languages; everything is fair game. That said, your unit tests are not your actual code anymore; they&apos;re modified objects. Number 3, while intentional in unit tests, is not following pure function rules. You give a function inputs and test its outputs. An <code>Error</code> is not an output, it&apos;s a side effect. Again, you get a pass because technically it&apos;s the mock throwing the error, not your function/class.</p>
<p>... however, #2 is not ok at all.</p>
<h2 id="conclusions">Conclusions</h2>
<p>As you can see, there is zero need for spies/mocks with pure functions because:</p>
<ol>
<li>no need to mutate the object before or after; it&apos;s a <code>function</code> and you use as is</li>
<li>no need to setup assertions on how something should be used, you&apos;re just calling 1 function and checking the outputs are expected based on the inputs</li>
<li>Side effects?</li>
</ol>
<p>You&apos;ll assume no side effects, yes, HOWEVER, don&apos;t discount testing for them. Using unit tests to test for the LACK OF side effects is actually something unit tests are really good at. If you&apos;re not sure if code is 100% pure, unit tests will help you track them down. Just be aware these tests will rot over time, especially if you are testing private module methods. Feel free to delete later vs. maintain them.</p>
<p>Mocks aren&apos;t used in Functional Programming because there are no side effects to test for. The Object under test is always a <code>function</code>, so there is no <code>class</code> method or <code>Object</code> property to modify and watch. You&apos;re just testing the functions that take inputs and have expected outputs. Some of those inputs may be slow, complicated, or from hard to setup 3rd party code so pure function stubs may be used.</p>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="./" class="navigation navigation-prev " aria-label="Previous page: Part 9: Testing">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="testing.html" class="navigation navigation-next " aria-label="Next page: Testing">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Why We Use Stubs and Not Mocks","level":"1.10.1","depth":2,"next":{"title":"Testing","level":"1.10.2","depth":2,"path":"part9/testing.md","ref":"part9/testing.md","articles":[]},"previous":{"title":"Part 9: Testing","level":"1.10","depth":1,"path":"part9/README.md","ref":"part9/README.md","articles":[{"title":"Why We Use Stubs and Not Mocks","level":"1.10.1","depth":2,"path":"part9/stubs_and_mocks.md","ref":"part9/stubs_and_mocks.md","articles":[]},{"title":"Testing","level":"1.10.2","depth":2,"path":"part9/testing.md","ref":"part9/testing.md","articles":[]},{"title":"Predicate Property Testing","level":"1.10.3","depth":2,"path":"part9/property_testing.md","ref":"part9/property_testing.md","articles":[]}]},"dir":"ltr"},"config":{"gitbook":"*","theme":"default","variables":{},"plugins":[],"pluginsConfig":{"highlight":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"}},"file":{"path":"part9/stubs_and_mocks.md","mtime":"2018-09-02T14:56:38.711Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2018-11-11T17:31:15.180Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

